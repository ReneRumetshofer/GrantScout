<!doctype html>
<html lang="de">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Förderantrags-Chat</title>
    <link href="../bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/chat.css" rel="stylesheet">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="../index.html">GrantScout</a>
        <div class="navbar-nav">
            <a class="nav-link" href="chat.html">Chats</a>
        </div>
    </div>
</nav>
<div class="wrap">
    <h1>Förderantrags‑Chat</h1>
    <div id="log"></div>
    <form id="f">
        <input id="q" placeholder="Frage stellen…" required />
        <button id="send">Senden</button>
    </form>
</div>
<script>
    const API = 'https://localhost/api/chat';
    const log = document.getElementById('log');
    const form = document.getElementById('f');
    const q = document.getElementById('q');
    const history = [];

    function push(role, content){
        const div = document.createElement('div');
        div.className = 'msg ' + role;
        div.innerHTML = `<div class="role">${role}</div><div class="bubble"></div>`;
        div.querySelector('.bubble').textContent = content;
        log.appendChild(div);
        log.scrollTop = log.scrollHeight;
    }

    form.addEventListener('submit', async (e)=>{
        e.preventDefault();
        const text = q.value.trim();
        if(!text) return;
        q.value = '';
        push('user', text);
        form.send.disabled = true;

        const res = await fetch(API,{
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify({ message:text, history })
        });
        const data = await res.json();
        push('assistant', data.reply);
        history.push({role:'user', content:text});
        history.push({role:'assistant', content:data.reply});
        form.send.disabled = false;
    });
</script>
<script src="../bootstrap/js/bootstrap.bundle.min.js"></script>
</body>
</html>